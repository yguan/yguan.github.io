define(["require","exports","module","data/bookmark-repository","data/tag-group-repository"],function(e,t,n){var r=e("data/bookmark-repository"),i=e("data/tag-group-repository"),s=function(){var e='<div class="ngCellText"><a href="{url}" title="{url}" target="_blank">{title}</a></div>';return e.replace(/{url}/g,"{{row.getProperty('url')}}").replace("{title}","{{row.getProperty(col.field)}}")},o={dateAdded:'<div class="ngCellText">{{row.getProperty(col.field).toLocaleDateString()}}</div>',"delete":'<span class="delete-cell" ng-click="delete()" title="delete"></span>',title:s()};t.name="SearchCtrl",t.controller=function(e,t){function u(){e.gridData=[],i.findAll(e.keywords,{success:function(t){_.each(t,function(t){r.findByKey("tagGroupId",t.id,{success:function(t){e.gridData=_.uniq(_.union(e.gridData,t),"id"),e.$apply()},failure:function(e){console.log(e)}})})}})}function a(){e.gridData=[],r.findByTitle(e.keywords,{success:function(t){e.gridData=_.uniq(_.union(e.gridData,t),"id"),e.$apply()},failure:function(e){console.log(e)}})}function f(){var t=e.keywords.length>0;t?e.keywordType==="tag"?u():a():e.gridData.length>0&&(e.gridData=[])}var n=t.search().tags,s=function(t){return t+"?tags="+encodeURIComponent(e.keywords.join(","))};e.getTags=function(){return i.getAllTags()},e.go=function(e){t.url(e)},e.goWithTags=function(e){t.url(s(e))},e.keywords=[],e.gridData=[],e.keywordType="tag",e.gridOptions={data:"gridData",enableCellSelection:!1,enableRowSelection:!1,enableCellEditOnFocus:!1,enableColumnResize:!0,columnDefs:[{field:"title",displayName:"Title",cellTemplate:o.title},{field:"dateAdded",displayName:"Date Added",width:100,cellTemplate:o.dateAdded},{field:"id",displayName:"-",width:20,cellTemplate:o.delete}]},e.delete=function(){var t=this.row.orig.entity.id;index=_.findIndex(e.gridData,function(e){return e.id===t}),r.remove(t),e.gridData.splice(index,1)},e.$watch("keywords",function(e,t){f()},!0),e.$watch("keywordType",function(e,t){f()},!0),n&&(e.keywords=n.split(", "))}});
define(["require","exports","module","data/bookmark-loader","data/idb","data/bookmark-repository","lib/FileSaver","view/tab"],function(e,t,n){function a(e){setTimeout(function(){e.alerts=[],e.$apply()},2e3)}var r=e("data/bookmark-loader"),i=e("data/idb"),s=e("data/bookmark-repository"),o=e("lib/FileSaver"),u=e("view/tab");t.name="ActionsCtrl",t.controller=function(e,t){var n={success:function(t){e.alerts=[{type:"success",msg:t||"Loaded bookmarks successfully."}],e.loadBtn.disabled=!1,e.$apply(),a(e)},failure:function(t){e.alerts=[{type:"error",msg:t||"Failed to load all bookmarks."}],e.$apply()}},f={success:function(t){e.alerts=[{type:"success",msg:t||"Exported bookmarks successfully."}],e.exportBtn.disabled=!1,e.$apply(),a(e)},failure:function(t){e.alerts=[{type:"error",msg:t||"Failed to export bookmarks."}],e.$apply()}};e.alerts=[],e.loadBtn={disabled:!1},e.exportBtn={disabled:!1},e.uploadBookmarkVisible=!1,e.go=function(e){t.url(e)},e.openNewTab=function(e){u.openInNewTab(e)},e.loadBookmarks=function(){e.loadBtn.disabled=!0,e.alerts=[{type:"info",msg:"Loading bookmarks from Chrome"}],chrome.bookmarks&&r.loadBookmarksFromChrome(n)},e.exportDB=function(){e.exportBtn.disabled=!0,e.alerts=[{type:"info",msg:"Exporting bookmarks"}],i.export({success:function(e){var t=new Blob([JSON.stringify(e)],{type:"text/plain;charset=utf-8"});o.saveAs(t,"bookmarks.json"),f.success()}},f)},e.showUpload=function(){e.uploadBookmarkVisible=!0},e.onFileSelect=function(t){e.alerts=[{type:"info",msg:"Loading bookmarks."}];var n=new FileReader,r=t[0],i=r.slice(0,r.size);n.onload=function(){var t=n.result,r={};if(t.length>0){var i=JSON.parse(t);_.each(i.tagGroup,function(e){r[e.id]=e.tags}),_.each(i.bookmark,function(e){e.tags=r[e.tagGroupId],e.dateAdded=new Date(e.dateAdded)}),s.addAll(i.bookmark,{success:function(t){e.uploadBookmarkVisible=!1,e.alerts=[{type:"success",msg:"Loaded bookmarks successfully."}],e.$apply(),a(e)},failure:function(t){e.alerts=[{type:"error",msg:"Failed to load bookmarks"}],e.$apply()}})}},n.readAsText(i)},e.addAlert=function(){e.alerts.push({msg:"Another alert!"})},e.closeAlert=function(t){e.alerts.splice(t,1)}}});
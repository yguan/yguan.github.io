define(["require","exports","module","data/bookmark-repository","data/tag-group-repository"],function(e,t,n){var r=e("data/bookmark-repository"),i=e("data/tag-group-repository");t.name="AddCtrl",t.controller=function(e,t){function n(t){return t+"?tags="+encodeURIComponent(e.selectedTags.join(","))}function s(){chrome.tabs&&chrome.tabs.query?chrome.tabs.query({active:!0,currentWindow:!0},function(t){var n=t[0],s=n.url;e.url=s,e.title=n.title,e.$apply(),r.findByKey("url",s,{success:function(t){var n=t[0];t.length>0&&(e.title=n.title,i.get(n.tagGroupId,{success:function(t){e.selectedTags=t.tags,e.$apply()}}))}})}):(e.url=window.location.href,e.title=window.document.title)}s(),e.getTags=function(){return i.getAllTags()},e.title="",e.url="",e.selectedTags=[],e.isSaving=!1,e.isSaveBtnDisabled=function(e,t,n,r){return e.length===0||t.length===0||n.length===0||r},e.go=function(e){t.url(e)},e.goWithTags=function(e){t.url(n(e))},e.save=function(){e.isSaving=!0;var t=_.map(e.selectedTags,function(e){return e.toLowerCase()});i.add(t,{success:function(t){r.add({title:e.title,url:e.url,dateAdded:new Date,tagGroupId:t.id},{success:function(){window.close()},failure:function(e){console.log(e)}})}})}}});